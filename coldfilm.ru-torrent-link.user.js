// ==UserScript==
// @id             coldfilm.ru-6c434ad0-254a-410f-8d3c-c5172404085f@scriptish
// @name           auto-torrent-link
// @version        1.4
// @history        1.4 Из-за возросшей нагрузки на сайт переделал скрипт, теперь надо нажать кнопку рядом с названием для просмотра информации о нужном сериале, кнопку можно нажимать сколько угодно раз в ожидании серии.
// @history        1.3.1 Небольшие правки в тексте. 
// @history        1.3 Добавил проверку на внутренние ссылки на статичные страницы
// @history        1.2.1 Добавил ссылки на автообновление, на всякий случай.
// @history        1.2 Исправил перекрытие скриптов сайта и моим, т.о. вернул полную работоспособность сайта + мой скрипт.
// @history        1.1 Добавил mchat в исключения
// @history        1.0 Релиз
// @namespace      https://openuserjs.org/scripts/Black_Sun/auto-torrent-link
// @author         Black_Sun
// @description    Скрипт выводит на главную страницу под сериалом ссылки на торрент для скачивания, как только они появляются в новости. Делает много запросов, поэтому часто страницу не обновлять!
// @include        http://coldfilm.ru/*
// @exclude        http://coldfilm.ru/news/*/*
// @exclude        http://coldfilm.ru/mchat
// @exclude        http://coldfilm.ru/mchat/*
// @updateURL https://openuserjs.org/install/Black_Sun/auto-torrent-link.user.js
// @Download https://openuserjs.org/install/Black_Sun/auto-torrent-link.user.js
// @noframes
// @grant none
// @unwrap
// @run-at         document-end
// ==/UserScript==

$(function(){
	
	$('.entryLink').each(function(i){
		$('.viewn_cont').eq(i).append("<style>#lnks"+i+" a{display:block;color:green}.viewn_title{height:20px!important}</style><div id='lnks"+i+"' style='display:block;margin:0 auto;text-align:center;color:darkred;font-size:20px'></div>")
		$('#lnks'+i).closest('div.viewn_loop').find('h4.viewn_title').append('<span id="spanload'+i+'" title="Нажмите чтобы проверить можно ли скачать серию или нет" style="color:darkred"> <img id="imgload'+i+'" style="cursor:pointer" src="'+lookimg+'" /></span>')
		var self=$(this)
		$('#imgload'+i).click(function(){
			getter()
		})
		function getter(){
		$('#imgload'+i).unbind('click')
		$('#imgload'+i).attr('src',loadingimg)
		$('#lnks'+i).text('Идёт загрузка, пожалуйста подождите...')
		$.get(self.attr('href'),function(data){
				var ah=$('.eMessage',data).find('a');
				if(ah.attr('href')!="undefined"){$('#lnks'+i).html(ah);$('#imgload'+i).attr('src',lookimg)}
				if(ah.attr('href')===undefined || ah.attr('href').indexOf("coldfilm.ru/index")!=-1){
					/*$('#lnks'+i).closest('div[id^="entryID"]').remove()*/
					//$('#lnks'+i).closest('div.viewn_c').hide()
					$('#spanload'+i).text(' Серия ещё не выложена ').append('<img id="imgload'+i+'" style="cursor:pointer" src="'+lookimg+'" />').parent().parent().find('a').attr('style','color:darkred')
					$('#imgload'+i).click(function(){getter()});
					$('#lnks'+i).text('Серия ещё не выложена')
					
				}
			})
		}
	})
});	

var lookimg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAsJJREFUeNqMk8tPE1EUxu+dmU6n04dDKVAaQBowBYq0RDAQGkOC0QRjoujCx14TV8Z/gLB0Z8CNunGJJhJdGd8pkKALSdVoIIISiOE1JWPbofO6cz2jYKR1wUm+nJm53/nlnjvnYkopcmJkZEKCdB10BpRAf+ID6DHo1vDwkIL+E9gBQHHSMQYqA1VH+9rUrvZwFYMxmv2yJk+9+uhRc6rsgAGSKQWwGHdIAEm39bZJxwcS3vqw3yu6GcyxGAUl0ROLH+Tymo3ktexQOj13v7+/VfsXwJimdsMX8oWi0TqfQahtWNQqGralgXSTmvButiebAi6BCzne0h0wur59vqalUdFMuq2bdhYK5YJG5FyRyADaBMCGSehGJNa47nhLARwhRmsR+3Nyzlx0u7DOscTEmGVZBiGLUKKZtqVqNkuFQMTxlgEMYxvxbqysyHqGYVDeK3gE6F90sZiFdcMmNLe6ZWxvbqmd4G0qAxQKyiKmP4nbJa0GRK4AB4i8AsvzHGZMixKT2Hq15EKzk59Nx1t2Boqy/vrTi5d1VUHGV1vB03AF7zkgsrUenmkOiGykRuLFoMd2Z5fnjjneMkAmM3V7ZX4+J8tfLzCsVQmFHvheD3L6rbd0vWJ8Yuxa12lZTFx+23f1Lk7uGSSnjXi8+2IslrgZaYr6U6dOLCSboiyPsHdy5v369Jt0ezH4UGg8rLnODp5DT54/UNezq6k7V2jm7yRijH2hULgnmUxd8vulXvgHLc4iIWQun1dmvjOPBlq7aUNHp4AGTzagp8+W1c2s9huCd+8CQDhIdaAQyLezwwJIrj2CUmI1utccR0JHN0Y9KRa9myaqotAUt9sLgCxISzvae2EwlmsSSFhAaEw3qADDhiKHRG/R0KY5tI8AeAEg487zCkAMzRZ+rGrIz9Nv+wKUQmDERtUcWfJxaPSXAAMAqY5Ou20jwNAAAAAASUVORK5CYII%3D"

var loadingimg="data:image/gif;base64,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%3D%3D"
